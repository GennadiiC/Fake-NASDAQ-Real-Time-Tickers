{"ast":null,"code":"import { createApi } from '@reduxjs/toolkit/query/react';\nimport { io } from 'socket.io-client';\nconst {\n  interval,\n  newEntry,\n  id\n} = args;\nexport const stockApiSlice = createApi({\n  reducerPath: 'stockApiSlice',\n  endpoints: builder => ({\n    getStocks: builder.query({\n      queryFn: () => ({\n        data: []\n      }),\n\n      async onCacheEntryAdded(args, _ref) {\n        let {\n          updateCachedData,\n          cacheEntryRemoved\n        } = _ref;\n        const socket = io('http://localhost:4000');\n        socket.emit('start', interval);\n\n        if (newEntry !== '') {\n          socket.emit('add', newEntry);\n        }\n\n        if (id !== '') {\n          socket.emit('delete', id);\n        }\n\n        socket.on('ticker', data => {\n          updateCachedData(draft => {\n            draft.push(data);\n\n            if (draft.length > 1) {\n              draft.shift();\n              return draft;\n            }\n          });\n        });\n        await cacheEntryRemoved;\n      }\n\n    })\n  })\n});\nexport const {\n  useGetStocksQuery\n} = stockApiSlice;","map":{"version":3,"names":["createApi","io","interval","newEntry","id","args","stockApiSlice","reducerPath","endpoints","builder","getStocks","query","queryFn","data","onCacheEntryAdded","updateCachedData","cacheEntryRemoved","socket","emit","on","draft","push","length","shift","useGetStocksQuery"],"sources":["/Users/g/Documents/myCodeProjects/finance-test-task/client/src/redux/stockApiSlice.js"],"sourcesContent":["import { createApi } from '@reduxjs/toolkit/query/react';\nimport { io } from 'socket.io-client';\n\nconst { interval, newEntry, id } = args\n\nexport const stockApiSlice = createApi({\n  reducerPath: 'stockApiSlice',\n  endpoints: builder => ({\n    getStocks: builder.query({\n      queryFn: () => ({ data: [] }),\n      async onCacheEntryAdded(args, { updateCachedData, cacheEntryRemoved }) {\n        const socket = io('http://localhost:4000')\n\n        socket.emit('start', interval) \n\n        if (newEntry !== '') {\n          socket.emit('add', newEntry)\n        }\n\n        if (id !== '') {\n          socket.emit('delete', id)\n        }\n        \n        socket.on('ticker', (data) => {\n      \n          updateCachedData((draft) => {\n            draft.push(data)\n            if (draft.length > 1) {\n              draft.shift()\n              return draft\n            }\n          })\n        })\n        await cacheEntryRemoved\n      }\n    }),\n  }),\n})\n\n\nexport const { useGetStocksQuery } = stockApiSlice;"],"mappings":"AAAA,SAASA,SAAT,QAA0B,8BAA1B;AACA,SAASC,EAAT,QAAmB,kBAAnB;AAEA,MAAM;EAAEC,QAAF;EAAYC,QAAZ;EAAsBC;AAAtB,IAA6BC,IAAnC;AAEA,OAAO,MAAMC,aAAa,GAAGN,SAAS,CAAC;EACrCO,WAAW,EAAE,eADwB;EAErCC,SAAS,EAAEC,OAAO,KAAK;IACrBC,SAAS,EAAED,OAAO,CAACE,KAAR,CAAc;MACvBC,OAAO,EAAE,OAAO;QAAEC,IAAI,EAAE;MAAR,CAAP,CADc;;MAEvB,MAAMC,iBAAN,CAAwBT,IAAxB,QAAuE;QAAA,IAAzC;UAAEU,gBAAF;UAAoBC;QAApB,CAAyC;QACrE,MAAMC,MAAM,GAAGhB,EAAE,CAAC,uBAAD,CAAjB;QAEAgB,MAAM,CAACC,IAAP,CAAY,OAAZ,EAAqBhB,QAArB;;QAEA,IAAIC,QAAQ,KAAK,EAAjB,EAAqB;UACnBc,MAAM,CAACC,IAAP,CAAY,KAAZ,EAAmBf,QAAnB;QACD;;QAED,IAAIC,EAAE,KAAK,EAAX,EAAe;UACba,MAAM,CAACC,IAAP,CAAY,QAAZ,EAAsBd,EAAtB;QACD;;QAEDa,MAAM,CAACE,EAAP,CAAU,QAAV,EAAqBN,IAAD,IAAU;UAE5BE,gBAAgB,CAAEK,KAAD,IAAW;YAC1BA,KAAK,CAACC,IAAN,CAAWR,IAAX;;YACA,IAAIO,KAAK,CAACE,MAAN,GAAe,CAAnB,EAAsB;cACpBF,KAAK,CAACG,KAAN;cACA,OAAOH,KAAP;YACD;UACF,CANe,CAAhB;QAOD,CATD;QAUA,MAAMJ,iBAAN;MACD;;IA1BsB,CAAd;EADU,CAAL;AAFmB,CAAD,CAA/B;AAmCP,OAAO,MAAM;EAAEQ;AAAF,IAAwBlB,aAA9B"},"metadata":{},"sourceType":"module"}