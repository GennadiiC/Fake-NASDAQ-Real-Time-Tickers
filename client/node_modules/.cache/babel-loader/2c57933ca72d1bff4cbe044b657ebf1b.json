{"ast":null,"code":"import { createApi, fetchBaseQuery } from '@reduxjs/toolkit/query/react';\nimport { io } from 'socket.io-client';\nexport const stockApiSlice = createApi({\n  reducerPath: 'stockApiSlice',\n  baseQuery: fetchBaseQuery({\n    baseUrl: '/'\n  }),\n  endpoints: builder => ({\n    getStocks: builder.query({\n      queryFn: () => ({\n        data\n      }),\n\n      async onCacheEntryAdded(arg, {\n        updateCachedData,\n        cacheDataLoaded,\n        cacheEntryRemoved\n      }) {\n        try {\n          await cacheDataLoaded;\n          const socket = io('http://localhost:4000');\n          socket.emit('connection', () => {\n            console.log('connected');\n          });\n          socket.emit('start', () => {\n            console.log('started');\n          }); // const listener = (event) => {\n          //   const data = JSON.parse(event.data)\n          //   if ( data !== arg ) return\n          //   updateCachedData((draft) => {\n          //     draft.push(data)\n          //     console.log(draft)\n          //   })\n          // }\n\n          socket.on('ticker', ticker => {\n            console.log(ticker);\n            if (ticker !== arg) return;\n            updateCachedData(draft => {\n              draft.push(ticker);\n              console.log(draft);\n            });\n          });\n        } catch {}\n\n        await cacheEntryRemoved;\n      }\n\n    })\n  })\n});\nexport const {\n  useGetStocksQuery\n} = stockApiSlice;","map":{"version":3,"sources":["/Users/g/Documents/myCodeProjects/finance-test-task/client/src/redux/stockApiSlice.js"],"names":["createApi","fetchBaseQuery","io","stockApiSlice","reducerPath","baseQuery","baseUrl","endpoints","builder","getStocks","query","queryFn","data","onCacheEntryAdded","arg","updateCachedData","cacheDataLoaded","cacheEntryRemoved","socket","emit","console","log","on","ticker","draft","push","useGetStocksQuery"],"mappings":"AAAA,SAASA,SAAT,EAAoBC,cAApB,QAA0C,8BAA1C;AACA,SAASC,EAAT,QAAmB,kBAAnB;AAEA,OAAO,MAAMC,aAAa,GAAGH,SAAS,CAAC;AACrCI,EAAAA,WAAW,EAAE,eADwB;AAErCC,EAAAA,SAAS,EAAEJ,cAAc,CAAC;AAAEK,IAAAA,OAAO,EAAE;AAAX,GAAD,CAFY;AAGrCC,EAAAA,SAAS,EAAEC,OAAO,KAAK;AACrBC,IAAAA,SAAS,EAAED,OAAO,CAACE,KAAR,CAAc;AACvBC,MAAAA,OAAO,EAAE,OAAO;AAAEC,QAAAA;AAAF,OAAP,CADc;;AAEvB,YAAMC,iBAAN,CACEC,GADF,EAEE;AAAEC,QAAAA,gBAAF;AAAoBC,QAAAA,eAApB;AAAqCC,QAAAA;AAArC,OAFF,EAGE;AAEA,YAAI;AACF,gBAAMD,eAAN;AACA,gBAAME,MAAM,GAAGhB,EAAE,CAAC,uBAAD,CAAjB;AACAgB,UAAAA,MAAM,CAACC,IAAP,CAAY,YAAZ,EAA0B,MAAM;AAC9BC,YAAAA,OAAO,CAACC,GAAR,CAAY,WAAZ;AACD,WAFD;AAIAH,UAAAA,MAAM,CAACC,IAAP,CAAY,OAAZ,EAAqB,MAAM;AACzBC,YAAAA,OAAO,CAACC,GAAR,CAAY,SAAZ;AAED,WAHD,EAPE,CAaF;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;;AAEAH,UAAAA,MAAM,CAACI,EAAP,CAAU,QAAV,EAAqBC,MAAD,IAAY;AAC9BH,YAAAA,OAAO,CAACC,GAAR,CAAYE,MAAZ;AACA,gBAAKA,MAAM,KAAKT,GAAhB,EAAsB;AACtBC,YAAAA,gBAAgB,CAAES,KAAD,IAAW;AAC1BA,cAAAA,KAAK,CAACC,IAAN,CAAWF,MAAX;AACAH,cAAAA,OAAO,CAACC,GAAR,CAAYG,KAAZ;AACD,aAHe,CAAhB;AAKD,WARD;AASD,SAhCD,CAgCE,MAAM,CAEP;;AACD,cAAMP,iBAAN;AAED;;AA5CsB,KAAd;AADU,GAAL;AAHmB,CAAD,CAA/B;AAqDP,OAAO,MAAM;AAAES,EAAAA;AAAF,IAAwBvB,aAA9B","sourcesContent":["import { createApi, fetchBaseQuery } from '@reduxjs/toolkit/query/react';\nimport { io } from 'socket.io-client';\n\nexport const stockApiSlice = createApi({\n  reducerPath: 'stockApiSlice',\n  baseQuery: fetchBaseQuery({ baseUrl: '/'}),\n  endpoints: builder => ({\n    getStocks: builder.query({\n      queryFn: () => ({ data }),\n      async onCacheEntryAdded(\n        arg, \n        { updateCachedData, cacheDataLoaded, cacheEntryRemoved }\n      ) {\n    \n        try {\n          await cacheDataLoaded;\n          const socket = io('http://localhost:4000');\n          socket.emit('connection', () => {\n            console.log('connected')\n          })\n\n          socket.emit('start', () => {\n            console.log('started')\n            \n          })\n          \n\n          // const listener = (event) => {\n          //   const data = JSON.parse(event.data)\n          //   if ( data !== arg ) return\n\n          //   updateCachedData((draft) => {\n          //     draft.push(data)\n          //     console.log(draft)\n          //   })\n          // }\n\n          socket.on('ticker', (ticker) => {\n            console.log(ticker)\n            if ( ticker !== arg ) return\n            updateCachedData((draft) => {\n              draft.push(ticker)\n              console.log(draft)\n            })\n            \n          })\n        } catch {\n\n        }\n        await cacheEntryRemoved;\n        \n      },\n    }),\n  }),\n})\n\nexport const { useGetStocksQuery } = stockApiSlice;"]},"metadata":{},"sourceType":"module"}